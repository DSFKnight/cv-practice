# Практическая работа №2. Детектирование объектов на изображениях с использованием библиотеки OpenCV

Разработана программа для детектирования объектов с использованием обученной нейронной сети YOLOv3.

## Структура программы

Программа содержит:
- `cli_argument_parser() - парсер аргументов командной строки`
- `load_names - функция загрузки имён классов`
- `read_img - функция загрузки изображения`
- `show_img - функция отображения изображения`
- `preprocess_image - функция предварительной обработки изображения`
- `detect_objects - функция детектирования объектов на изображении`
- `count_objects - функция для подсчёта количества обнаруженных объектов каждого класса`
- `output_objects - функция отображения количества обнаруженных объектов каждого класса на изображении`
- `process_video - функция обработки видео`
- `main() - основная функция программы`

## Описание функций

1. **Функция-парсер аргументов командной строки.** 
- `-i` - путь к входному файлу изображения или видео
- `-o` - имя выходного файла
- `-m` - режим работы (изображение или видео) (по умолчанию image)
- `-cfg` - путь к конфигурационному файлу нейронной сети (по умолчанию yolov3.cfg)
- `-w` - путь к файлу весов нейронной сети (по умолчанию yolov3.weights)
- `-names` - путь к файлу, содержащему имена классов объектов (по умолчанию coco.names)
- `-ct` - пороговое значение уверенности (по умолчанию 0.5)
- `-nt` -  пороговое значение для подавления не максимальных значений (по умолчанию 0.4)

2. **Функция загрузки имён классов.**
 Данная функция загружает имена классов объектов, которые детектируются нейронной сетью.
 Она открывает файл с классами в режиме чтения, считывает все строки файла и возвращает
 список имён.

3. **Функция загрузки изображения.**
 Данная функция проверяет корректность пути к изображению, загружает изображение из
 указанного пути и возвращает загруженное изображение.

4. **Функция отображения изображения.**
 Данная функция проверяет наличие изображения и, если оно существует, отображает его.

5. **Функция предварительной обработки изображения.**
 Данная функция подготавливает изображение для использования и устанавливает его в качестве
 входных данных для нейронной сети. Сначала она получает высоту и ширину изображения, далее
 преобразует изображение в формат, подходящий для работы с нейронной сетью (нормализует
 пиксельные значения, изменяет размер и порядок цветовых каналов), преобразованное изображение
 устанавливает в качестве входных данных для нейронной сети. Функция возвращает исходные
 размеры изображения.
 
6. **Функция детектирования объектов на изображении.**
 Данная функция получает имена выходных слоев нейронной сети, обнаруживает ограничивающие
 прямоугольники и их уверенности, применяет алгоритм NMS для подавления не максимальных
 значений, что помогает избежать дублирования обнаружений, а затем отрисовывает ограничивающие
 прямоугольники на изображении. Прямоугольники отрисовываются разными цветами для объектов
 разных классов, вверху пишется название класса и достоверность наличия объекта в этом
 прямоугольнике. Функция возвращает список обнаруженных объектов и изменённое изображение.

7. **Функция для подсчёта количества обнаруженных объектов каждого класса.**
 Данная функция перебирает список обнаруженных объектов и для каждого класса подсчитывает их
 количество. 

8. **Функция отображения количества обнаруженных объектов каждого класса на изображении.** 
 Данная функция подсчитывает количество объектов каждого класса, выводит на изображение строку
 с именем класса и количеством объектов для каждого класса и возвращает изображение с
 добавленным текстом.

9. **Функция обработки видео.**
 Данная функция загружает видео, в бесконечном цикле обработки кадров выполняет
 предварительную обработку кадра, объектную детекцию и отображает получившийся кадр.
 Обработка прекращается при достижении конца видео или нажатии клавиши 'q'.
