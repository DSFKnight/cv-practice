# Практическая работа №3. Классификация изображений с использованием библиотеки OpenCV

## Описание программы и её структура

Разработано консольное приложение для классификации изображений.

Программа состоит из класса **VisualClassifier**. Поля класса:

- ```resize_dims``` - размер изображений, к которому они будут изменены;

- ```cluster_count``` - количество кластеров для алгоритма K-means;

- ```seed``` - значение для инициализации генератора случайных чисел;

- ```feature_extractor``` - Создание объекта для извлечения признаков из изображений с    использованием алгоритма SIFT;

- ```cluster_model``` - модель K-means для кластеризации дескрипторов;

- ```scaler``` - масштабирование признаков;

- ```svm``` - классификатор (SVC с RBF ядром).

Эти поля инициализируются в конструкторе класса ```__init__```.

Методы класса:

- ```__init__(self, cluster_count=100, resize_dims=(256, 256), seed=21)``` - конструктор класса, инициализирует поля класса;

- ```load_data``` - метод, который загружает изображения из указанной папки и присваивает им метку.

- ```process_data(self, train_dir, test_dir, class1, class2)``` - метод, который подготавливает данные для обучения и тестирования, загружая изображения из тренировочной и тестовой папок;

- ```extract_features(self, images)``` - метод, извлекающий дескрипторы из изображений;

- ```train_model(self, X_train, y_train)``` - метод, обучающий модель на тренировочных данных;

- ```evaluate_model(self, X_test, y_test)``` - метод, который оценивает модель на тестовых данных и выводит точность и отчёт о классификации;

- ```visualize_keypoints(self, images, number=3)``` - метод, визуализирующий SIFT-дескрипторы для нескольких изображений;

Также в программе есть функция ```main()``` - основная функция программы.

## Описание методов
### 1. Метод загрузки изображений
В этой функции происходит загрузка изображения из указанной папки и присвоение им метки. Далее в переменные записываются имена всех слоёв сети и выходные слои, которые не связаны с другими слоями. Метод возвращает сеть и список выходных слоёв. Сначала создаются пустые списки для изображений и меток. Далее программа проходит по всем файлам в указанной папке, считывает каждое изображение и изменяет его размер до image_size (256x256) (если оно существует). После этого изображение и метка добавляются в соответствующие списки.

### 2. Метод подготовки данных
В этом методе данные подготавливаются для обучения и тестирования. Изначально загружаются изображения кошек и собак из тренировочной и тестовой папок для двух классов (о - класс кошек, 1 - класс собак). Далее программа объединяет изображения и метки для тренировочной и тестовой выборок. После этого данные перемешиваются, обеспечивая таким образом их случайность.

### 3. Метод извлечения дескрипторов
Данная функция извлекает дескрипторы из изображений. Сначала создаётся пустой список дескрипторов. После этого программа проходит по каждому изображению и преобразует их в оттенки серого. Далее происходит извлечение ключевых точек и дескрипторов с помощью SIFT. Затем дескрипторы добавляются в список.

### 4. Метод обучения модели
Данный метод обучает модель на тренировочных данных. Изначально из тренировочных изображений извлекаются дескрипторы. Затем все дескрипторы объединяются в один массив. После этого модель K-means обучается на извлечённых дескрипторах. Далее для тренировочных данных строятся векторы признаков, после чего признаки масштабируются. Затем происходит обучение классификатора SVC на тренировочных данных.

### 5. Метод, оценивающий модель на тестовых данных.
Данная функция оценивает модель на тестовых данных и выводит точность и отчёт о классификации. Изначально из тестовых изображений извлекаются дескрипторы. Далее для тестовых данных строятся векторы признаков, после чего признаки масштабируются. Затем программа предсказывает метки для тестовых данных, вычисляет точность и выводит отчёт о классификации.

### 6. Метод визуализации дескрипторов
В этом методе для нескольких изображений визуализируются дескрипторы. Сначала программа ограничивает количество изображений для отображения, это делается для того, чтобы введённое число не оказалось больше, чем число изображений. После создаётся фигура с подграфиками. Каждое изображение преобразуется в изображение в оттенках серого. Из изображения извлекаются ключевые точки, которые затем рисуются на изображении. После этого программа отображает оригинальное изображение и изображение с дескрипторами.

## Описание команд
Для того, чтобы запустить программу, в командной строке необходимо указать следующую команду:
```
python cv_lab3.py -tr <путь к тренировочным данным> -te <путь к тестовым данным> -cn1 <название первого класса> -cn2 <название второго класса> -k <число кластеров> -in <число изображений>
```

### Описание аргументов
В командной строке можно использовать следующие аргументы:

- `-tr` или `--train`: указывает путь к папке, содержащей тренировочные изображения. Является необходимым параметром при запуске программы.
- `-te` или `--test`: указывает путь к папке, содержащей тестовые изображения. Является необходимым параметром при запуске программы.
- `-cn1` или `--first_class_name`: указывает имя первого класса, который будет использоваться для классификации. Является необходимым параметром при запуске программы.
- `-cn2` или `--second_class_name`: указывает имя второго класса, который будет использоваться для классификации. Является необходимым параметром при запуске программы.
- `-k` или `--clusters`: указывает количество кластеров, которые будут использоваться в алгоритме K-means для кластеризации дескрипторов. Параметр необязательный.
- `-in` или `--image_number`: указывает число изображений, которые отобразятся в оригинале и с дескрипторами. Тип аргумента: `int`. Параметр необязательный. Имеет значение по умолчанию `3`.

### Пример использования аргументов
Пример команды для запуска программы:

`` python lab3.py --train_dir C:\lab3\all_data\data\train --test_dir C:\lab3\all_data\data\test --class1 cats --class2 dogs --clusters 50 --vis_images 200```